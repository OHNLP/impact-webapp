<div class="menu-bar-box">
  <button *ngIf="hasChanged"
    mat-raised-button
    (click)="onClickSaveChanges()"
    class="mr-2"
    style="color:red;">
      <mat-icon>save</mat-icon>
      Save Changes
  </button>

  <button mat-raised-button
    class="mr-2"
    (click)="toggleEditor()">
    <mat-icon>edit_note</mat-icon>
    Toggle Editor
  </button>

  <button mat-raised-button
    class="mr-2"
    (click)="shareCohortDef()">
    <mat-icon>share</mat-icon>
    Share
  </button>
</div>



<div class="editor-box d-flex flex-row"
  style="height: calc( 100% - 65px); overflow-y: hidden;">

  <!-- for viewer mode -->
  <div *ngIf="this.appStatus.uwCriteriaUseEditorMode"
    class="json-editor-box">
      <json-editor
        #editor
        [data]="this.appStatus.uwCriteria!" 
        [options]="editorOptions"
        (change)="onChangeJSONEditor($event)">
      </json-editor>
  
  </div>
  
  <!-- for editor mode -->
  <div *ngIf="!this.appStatus.uwCriteriaUseEditorMode"
    class="json-editor-box">

  <mat-tree [dataSource]="dataSource" 
    [treeControl]="treeControl" 
    #tree 
    class="cohort-definition-tree">
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
      <button mat-icon-button disabled></button>
      <mat-icon class="type-icon" [attr.aria-label]="node.type + 'icon'">
        {{ node.nodeType === nodeType.ENTITY ? 'description' : 'folder' }}
      </mat-icon>
      {{ getNodeName(node) }}
      <!-- <button mat-icon-button *ngIf="node.value !== 'root'" (click)="openEditorDialog(node)">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button *ngIf="node.value !== 'root'" (click)="deleteNode(node)">
        <mat-icon>delete</mat-icon>
      </button> -->
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
      <div class="mat-tree-node">
        <button mat-icon-button matTreeNodeToggle
                [attr.aria-label]="'Toggle ' + node.name">
          <mat-icon class="mat-icon-rtl-mirror">
            {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
          </mat-icon>
        </button>
        <mat-icon class="type-icon" [attr.aria-label]="node.nodeType + 'icon'">
          {{ node.nodeType === nodeType.ENTITY ? 'description' : 'folder' }}
        </mat-icon>
        {{ getNodeName(node) }}
        <!-- <button mat-icon-button (click)="openEditorDialog(newNode(), node)">
          <mat-icon>add</mat-icon>
        </button>
        <button mat-icon-button *ngIf="node.value !== 'root'" (click)="openEditorDialog(node)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button *ngIf="node.value !== 'root'" (click)="deleteNode(node)">
          <mat-icon>delete</mat-icon>
        </button> -->
      </div>
      <!-- There is inline padding applied to this div using styles.
                This padding value depends on the mat-icon-button width.  -->
      <div [class.cohort-definition-tree-invisible]="!treeControl.isExpanded(node)"
          role="group">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>
    </mat-nested-tree-node>
  </mat-tree>

  </div>

  <div class="json-helper-box">

    <mat-accordion multi>
      <mat-expansion-panel expanded>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>domain</mat-icon>
            <b>
              Phenotype Definition Conversion
            </b>
          </mat-panel-title>
          <mat-panel-description>
            
          </mat-panel-description>
        </mat-expansion-panel-header>
        
        <div>
          <p>
            Input phenotype name and get UMLS CUIs:
          </p>
          <mat-form-field class="example-full-width">
            <mat-label>Phenotype Name</mat-label>
            <input matInput 
              placeholder="E.g., GERD" 
              value=""
              [(ngModel)]="phenotype_keyword">
            <button *ngIf="phenotype_keyword" 
              matSuffix 
              mat-icon-button 
              aria-label="Clear" 
              (click)="phenotype_keyword=''">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
        
          <button mat-button 
            mat-raised-button
            class="ml-2"
            (click)="searchUMLSCodes()">
            <mat-icon>search</mat-icon>
            Search
          </button>

          <button mat-button 
            mat-raised-button
            class="ml-2"
            (click)="copyUMLSCodes()">
            <mat-icon>file_copy</mat-icon>
            Copy as a list
          </button>

        </div>

        <div *ngIf="this.appStatus.uwIsSearchingUMLSCodes"
          class="panel-result-list-box">
          Searching ...
        </div>

        <div *ngIf="!this.appStatus.uwIsSearchingUMLSCodes"
          class="panel-result-list-box">
          <table mat-table [dataSource]="dataSourceUMLSCodes"
            style="width: 100%;">
            <!-- first Column -->
            <ng-container matColumnDef="sourceUMLSCUI">
              <th mat-header-cell *matHeaderCellDef>UMLS Code</th>
              <td mat-cell *matCellDef="let element"> {{element.sourceUMLSCUI}} </td>
            </ng-container>

            <!-- 2 Column -->
            <ng-container matColumnDef="representation">
              <th mat-header-cell *matHeaderCellDef>Representation </th>
              <td mat-cell *matCellDef="let element">
                {{ element.representation }} 
                <span class="ds-data-source-label">
                  @{{ fmtDS(element.dataSourceID) }}
                </span>
                <br>
                {{ element.reperesentationDescription }}
              </td>
            </ng-container>
<!-- 
            3 Column
            <ng-container matColumnDef="reperesentationDescription">
              <th mat-header-cell *matHeaderCellDef>Description </th>
              <td mat-cell *matCellDef="let element">
                {{ element.reperesentationDescription }}
              </td>
            </ng-container> -->

            <!-- action Column -->
            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Action </th>
              <td mat-cell *matCellDef="let element">
                <button mat-button 
                  mat-raised-button
                  class="ml-2"
                  (click)="copyUMLSCode(element)">
                  <mat-icon>file_copy</mat-icon>
                  Copy Code
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsSearchUMLSCodes"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsSearchUMLSCodes;"></tr>
          </table>
        </div>

      </mat-expansion-panel>


      <!-- the panel for Phenotype search -->
      <mat-expansion-panel expanded>
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>
              library_books
            </mat-icon>
            <b>
              Phenotype Library
            </b>
          </mat-panel-title>
          <mat-panel-description>
            
          </mat-panel-description>
        </mat-expansion-panel-header>

        <p>
          Search shared phenotype representations 
        </p>

        <div>
          <mat-form-field class="example-full-width">
            <mat-label>Keyword</mat-label>
            <input matInput 
              placeholder="E.g., GERD" 
              value=""
              [(ngModel)]="library_keyword">
            <button *ngIf="library_keyword" 
              matSuffix 
              mat-icon-button 
              aria-label="Clear" 
              (click)="library_keyword=''">
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
        
          <button mat-button 
            mat-raised-button
            class="ml-2"
            (click)="searchPhenotypeReps()">
            <mat-icon>search</mat-icon>
            Search
          </button>

        </div>

        <div *ngIf="this.appStatus.uwIsSearchingPhenoReps"
          class="panel-result-list-box">
          Searching ...
        </div>

        <div *ngIf="!this.appStatus.uwIsSearchingPhenoReps"
          class="panel-result-list-box">

          <table mat-table [dataSource]="dataSourcePhenoReps"
            style="width: 100%;">

            <!-- 1 Column -->
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let element"> {{ element.type }} </td>
            </ng-container>

            <!-- 2 Column -->
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Title</th>
              <td mat-cell *matCellDef="let element"> {{element.title}} </td>
            </ng-container>

            <!-- action Column -->
            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef>Action </th>
              <td mat-cell *matCellDef="let element">
                <button mat-button 
                  mat-raised-button
                  class="ml-2"
                  (click)="copyPhenotypeRep(element)">
                  <mat-icon>file_copy</mat-icon>
                  Copy
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsSearchPhenoReps"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsSearchPhenoReps;"></tr>
          </table>

          <!-- <mat-accordion>

            <mat-expansion-panel
              *ngFor="let def of this.appStatus.uwPhenoReps">
              <mat-expansion-panel-header>
                <mat-panel-title class="mat-panel-title">
                  <button mat-button 
                    mat-raised-button                    
                    (click)="copyPhenotypeRep(def)">
                    <mat-icon>file_copy</mat-icon>
                    Copy
                  </button>
                  &nbsp;
                  &nbsp;
                  {{ def['title'] }}
                </mat-panel-title>
                
                <mat-panel-description>
                </mat-panel-description>

              </mat-expansion-panel-header>

              <pre [innerHTML]="getPhenotypeRepJSONStr(def)"></pre>

            </mat-expansion-panel>

          </mat-accordion> -->
          
        </div>


      </mat-expansion-panel>


    </mat-accordion>
  </div>

</div>
